#!/usr/bin/env node

/**
 * External dependencies
 */
import fs from 'fs';
import path from 'path';
import {default as config} from '../webpack.config.js';

const { entry } = config;

// create the entry directory
fs.mkdirSync('entry', {recursive: true});

let heading = `/**
 *  Autogenerated Entrypoint  
 *  DO NOT MODIFY
 */\n`;


Object.entries(entry).forEach(([e, files]) => {
    let correctFiles = files.map(f => `'${f.replace(process.cwd(), '').replaceAll('\\', '/')}'`)
    let output = `
import path from 'path';
import { fileURLToPath } from 'url';
const currentPath = path.resolve(path.dirname(fileURLToPath(import.meta.url)), '..');

export default {
    entry: {
        ${e}: [
            path.join(currentPath, ${correctFiles.join('),\n' + `\t`.repeat(3) + 'path.join(currentPath, ')})
        ]
    }
};
    `;


    // write and entrypoint 
    // this allows for serving of a specific entry.
    fs.writeFileSync(
        `./entry/${e}.js`,
        `${heading} ${output}`
    )
});
